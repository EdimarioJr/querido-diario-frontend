<p><em>Precisa de algumas dicas sobre raspagem de dados? O passo mais importante √© saber como analisar o site antes de come√ßar a desenvolver c√≥digo. Quer saber mais? Segue lendo!</em></p>
<hr>
<p><em>Este texto √© uma continua√ß√£o de <a href="https://queridodiario.ok.org.br/blog/post/28" target="_blank">"Conhe√ßa os desafios de raspagem do Querido Di√°rio"</a>. Se a raspagem feita no Querido Di√°rio ainda te deixa d√∫vidas, come√ßa por l√° e depois volta pra c√°. A gente te espera</em> üòÅ</p>
<h2>Escolhendo um munic√≠pio</h2>
<p>Para contribuir com a expans√£o da cobertura do projeto √© necess√°rio a escolha de um novo munic√≠pio para a implementa√ß√£o do seu raspador. Para isso, podemos consultar o <a href="https://github.com/orgs/okfn-brasil/projects/12" target="_blank">Quadro de Expans√£o de Cidades no Querido Di√°rio</a>. L√° encontramos o mapeamento dos munic√≠pios e seus sistemas publicadores, assim como as metas do projeto.</p>
<p>Da lista poderemos encontrar (ou n√£o encontrar) casos que se encontram em uma das seguintes fases:</p>
<ol>
<li><strong>N√£o mapeado</strong> - o munic√≠pio ainda n√£o foi mapeado em nenhuma das metas atuais e n√£o se encontra na lista</li>
<li><strong>Sem classifica√ß√£o de compatibilidade</strong> - o munic√≠pio j√° foi mapeado mas ainda n√£o foi realizada uma pr√©-an√°lise quanto a sua compatibilidade com o projeto</li>
<li><strong>Sem classifica√ß√£o de dificuldade</strong> - o munic√≠pio √© compat√≠vel com o projeto mas uma an√°lise r√°pida para estimar a dificuldade de implementa√ß√£o ainda n√£o foi realizada</li>
<li><strong>Classificado</strong> - o site √© compat√≠vel e sua dificuldade de implementa√ß√£o j√° foi estimada mas n√£o h√° coment√°rios na <em>issue</em> que indiquem o in√≠cio da implementa√ß√£o</li>
<li><strong>Implementa√ß√£o iniciada</strong> - algu√©m j√° comentou na <em>issue</em> que iniciou o processo de implementa√ß√£o</li>
<li><strong>Implementa√ß√£o em revis√£o</strong> - um <em>Pull Request</em> j√° foi feito com a implementa√ß√£o do c√≥digo e est√° sendo avaliado</li>
<li><strong>Integrado</strong> - o munic√≠pio j√° est√° "em produ√ß√£o", ou seja, dispon√≠vel na plataforma do QD</li>
</ol>
<p>Por enquanto vamos focar nos munic√≠pios que j√° foram classificados mas ainda n√£o tiveram implementa√ß√£o iniciada. Nestes j√° podemos analisar suas requisi√ß√µes e elementos da p√°gina para o desenvolvimento do raspador.</p>
<h2>Analisando um site para raspagem de dados</h2>
<p>No m√≥dulo 3 do curso <a href="https://escoladedados.org/courses/python-para-inovacao-civica/" target="_blank">Python para Inova√ß√£o C√≠vica</a> da <a href="https://escoladedados.org/" target="_blank">Escola de Dados</a> aprendemos conceitos de Python e raspagem de dados utilizando o QD como objeto de estudo. Este m√≥dulo est√° <a href="https://youtube.com/playlist?list=PLpWp6ibmzPTc2rod9Hc822_3zMaq9G-qE" target="_blank">dispon√≠vel gratuitamente</a> e nas aulas 5, 6 e 7 vemos como analisar os sites publicadores de di√°rios oficiais de Natal (RN) e Caetit√© (BA).</p>
<p><img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0030/analisando-site.png" alt="An√°lise de site curso Python para Inova√ß√£o C√≠vica" width="100%" /></p>
<p>Seguindo os conceitos apresentados nas aulas podemos tentar organizar nossa an√°lise antes de iniciar o desenvolvimento. Como sugest√£o de organiza√ß√£o podemos elencar os <strong>tipos de p√°gina</strong> presentes, os <strong>elementos de interesse</strong> contidos nelas e as <strong>requisi√ß√µes</strong> que conectam as p√°ginas para preencher o seguinte modelo:</p>
<h3>Modelo de organiza√ß√£o de an√°lise para raspagem</h3>
<h4>Tipos de p√°gina</h4>
<table>
<thead>
<tr>
<td>Nome</td>
<td>Imagem de exemplo</td>
</tr>
</thead>
<tbody>
<tr>
<td>P√°gina legal</td>
<td>Imagem para deixar a p√°gina visual</td>
</tr>
<tr>
<td>Outra p√°gina</td>
<td>Imagem diferenciada</td>
</tr>
</tbody>
</table>
<h4>Elementos de interesse</h4>
<table>
<thead>
<tr>
<td>Nome </td>
<td>Presente na p√°gina</td>
<td>Seletor </td>
<td>Relativo a</td>
<td>Tipo de objeto</td>
</tr>
</thead>
<tbody>
<tr>
<td>Muitas listas</td>
<td>P√°gina legal</td>
<td style="overflow-wrap: anywhere"> //ul</td>
<td>Ra√≠z</td>
<td>Lista de elementos</td>
</tr>
<tr>
<td>Ids de outras p√°ginas</td>
<td>P√°gina legal</td>
<td style="overflow-wrap: anywhere">./li/@id</td>
<td>Muitas listas</td>
<td>Lista de dados</td>
</tr>
<tr>
<td>Uma imagem</td>
<td>Outra p√°gina</td>
<td style="overflow-wrap: anywhere">//div[@id='main']/img</td>
<td>Ra√≠z</td>
<td>Elemento</td>
</tr>
<tr>
<td>Link da imagem</td>
<td>Outra p√°gina</td>
<td style="overflow-wrap: anywhere">./@href</td>
<td>Imagem</td>
<td>Dado</td>
</tr>
</tbody>
</table>
<h4>Requisi√ß√µes</h4>
<table>
<thead>
<tr>
<td>Nome</td>
<td> De</td>
<td>Para </td>
<td>Tipo de requisi√ß√£o</td>
<td>Exemplo de URL</td>
<td>Exemplo de formdata</td>
</tr>
</thead>
<tbody>
<tr>
<td>Requisi√ß√£o inicial</td>
<td>N/A</td>
<td>P√°gina legal</td>
<td>GET</td>
<td style="overflow-wrap: anywhere">https://pagina.legal</td>
<td>N/A</td>
</tr>
<tr>
<td>Acesso a outras p√°ginas</td>
<td>P√°gina legal</td>
<td>Outra p√°gina</td>
<td>POST</td>
<td style="overflow-wrap: anywhere">https://pagina.legal/outra</td>
<td>{"id": "1"}</td>
</tr>
</tbody>
</table>
<h4>Estrat√©gia de raspagem</h4>
<ol>
<li>Fazer "requisi√ß√£o inicial" para a "p√°gina legal"</li>
<li>Para cada lista em "muitas listas", obter "ids de outras p√°ginas"</li>
<li>Para cada "id de outra p√°gina" realizar "acesso a outras p√°ginas" utilizando o id coletado no formdata</li>
<li>Em cada "outra p√°gina", raspar "uma imagem"</li>
<li>Guardar o "link da imagem" da imagem raspada </li>
</ol>
<h2>Aplicando o modelo para Caetit√© (BA)</h2>
Agora vamos utilizar o di√°rio oficial de Caetit√© (BA) apresentado na aula 7 e complementado na aula 9 como objeto de estudo e ver como podemos preencher o modelo:</p>
<h3>Exemplo de preenchimento</h3>
<h4>Tipos de p√°gina</h4>
<table>
<thead>
<tr>
<td>Nome</td>
<td>Imagem de exemplo</td>
</tr>
</thead>
<tbody>
<tr>
<td>Listagem de publica√ß√µes</td>
<td><img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0030/caetite.png" alt="Listagem de publica√ß√£o em Caetit√©" width="100%" /></td>
</tr>
</tbody>
</table>
<h4>Elementos de interesse</h4>
<table>
<thead>
<tr>
<td>Nome </td>
<td>Presente na p√°gina</td>
<td>Seletor </td>
<td>Relativo a</td>
<td>Tipo de objeto</td>
</tr>
</thead>
<tbody>
<tr>
<td>Publica√ß√µes</td>
<td>Listagem de publica√ß√µes</td>
<td style="overflow-wrap: anywhere"> //div[@id='edicoes']/ul[@class!='grid']</td>
<td>Ra√≠z</td>
<td>Lista de elementos</td>
</tr>
<tr>
<td>Link da publica√ß√£o</td>
<td>Listagem de publica√ß√µes</td>
<td style="overflow-wrap: anywhere">./li[2]/a/@href</td>
<td>Publica√ß√£o</td>
<td>Dado</td>
</tr>
<tr>
<td>Edi√ß√£o da publica√ß√£o</td>
<td>Listagem de publica√ß√µes</td>
<td style="overflow-wrap: anywhere">./li[2]/a/text()</td>
<td>Publica√ß√£o</td>
<td>Dado</td>
</tr>
<tr>
<td>Data da publica√ß√£o</td>
<td>Listagem de publica√ß√µes</td>
<td style="overflow-wrap: anywhere">./li[1]/a/text()</td>
<td>Publica√ß√£o</td>
<td>Dado</td>
</tr>
<tr>
<td>Link para pr√≥xima p√°gina</td>
<td>Listagem de publica√ß√µes</td>
<td style="overflow-wrap: anywhere"> //div[@class!='proximo']/a/@href</td>
<td>Ra√≠z</td>
<td>Dado</td>
</tr>
</tbody>
</table>
<h4>Requisi√ß√µes</h4>
<table>
<thead>
<tr>
<td>Nome</td>
<td> De</td>
<td>Para </td>
<td>Tipo de requisi√ß√£o</td>
<td>Exemplo de URL</td>
<td>Exemplo de formdata</td>
</tr>
</thead>
<tbody>
<tr>
<td>Requisi√ß√£o inicial</td>
<td>N/A</td>
<td>Listagem de publica√ß√µes</td>
<td>GET</td>
<td style="overflow-wrap: anywhere">http://procedebahia.com.br/ba/caetite/edicoes</td>
<td>N/A</td>
</tr>
<tr>
<td>Pagina√ß√£o</td>
<td> Listagem de publica√ß√µes</td>
<td> Listagem de publica√ß√µes</td>
<td>GET</td>
<td style="overflow-wrap: anywhere">http://procedebahia.com.br/ba/caetite/edicoes&amp;pg=2</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h4>Estrat√©gia de raspagem</h4>
<ol>
<li>Fazer "requisi√ß√£o inicial" para a "listagem de publica√ß√µes"</li>
<li>Para cada "publica√ß√£o", obter seu "link", "data" e "edi√ß√£o"</li>
<li>Caso a publica√ß√£o seja posterior ao filtro de data, n√£o fazer nada. Caso esteja dentro do filtro, guardar o item com os dados obtidos. E caso seja anterior ao filtro de data, parar a raspagem</li>
<li>Se o "link para pr√≥xima p√°gina" existir, realizar "pagina√ß√£o"</li>
</ol>
<h2>Terminei a an√°lise, e agora?</h2>
<p>Agora voc√™ j√° pode adaptar sua an√°lise para o c√≥digo como apresentado na aula 9 do curso. Tamb√©m segue as <a href="https://docs.queridodiario.ok.org.br/pt-br/latest/escrevendo-um-novo-spider.html" target="_blank">indica√ß√µes da documenta√ß√£o sobre como escrever o raspador</a>. Se tiver d√∫vidas, comenta l√° no <a href="https://go.ok.org.br/discord" target="_blank">Discord da OKBR</a>. Submete um <em>Pull Request</em> e vamos trabalhar para integrar o raspador!</p>
<h2>E tamb√©m posso ajudar no mapeamento e classifica√ß√£o de munic√≠pios?</h2>
<p>A partir do texto anterior<em> <a href="https://queridodiario.ok.org.br/blog/post/28" target="_blank">"Conhe√ßa os desafios de raspagem do Querido Di√°rio"</a></em> j√° podemos entender que a an√°lise de um site para o QD pode terminar o classificando como "incompat√≠vel" com o projeto. Neste caso, no momento n√£o seguir√≠amos com a nossa an√°lise e adicionar√≠amos uma <a href="https://github.com/okfn-brasil/querido-diario/issues" target="_blank"><em>issue</em> ao reposit√≥rio</a> descrevendo a incompatibilidade.</p>
<p><img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0030/issue-incompativel.png" alt="Issue incompat√≠vel" width="100%" /></p>
<p> Quanto mais sites voc√™ raspar mais repert√≥rio voc√™ ter√° para estimar a dificuldade de raspagem do site tamb√©m. Nesse momento voc√™ dar√° uma for√ßa imensa para o projeto e para quem estiver come√ßando a contribuir com o reposit√≥rio!</p>
