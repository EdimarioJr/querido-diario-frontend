<p><em>Você já quis sua cidade no Querido Diário? Mas já se perguntou se é viável? Quais são as dificuldades? Ou o que possibilita adicionar uma cidade? Este texto se propõe a explicar um pouco mais sobre como o projeto funciona.</em></p>
<hr/>
<p>O Querido Diário é um projeto que amplia o acesso à informação sobre a administração pública brasileira em sua mais local instância, os municípios, através da abertura de diários oficiais eletrônicos. Não é uma empreitada fácil, sobretudo por existirem 5570 municípios no país e grandes discrepâncias quanto à maturidade na disponibilização de seus dados e informações. É, inclusive, comum ouvir que algumas regiões são “desertos de dados”.</p>
<p>Para isso, desenvolvemos robôs raspadores (<i>spiders</i>) que periodicamente acessam sites publicadores e coletam as edições de diários oficiais do executivo municipal, apenas. Conheça os desafios de raspagem, o panorama de publicações de diários oficiais eletrônicos e os reflexos que trazem para o projeto.</p>
<h2>O essencial</h2>
<p>Ao fazer uma busca qualquer no <a href="https://queridodiario.ok.org.br/" target="_blank">site do Querido Diário</a>, repare que junto a cada opção da lista de resultados há sempre o município e a data vinculados ao excerto do diário oficial que atende a operação de busca.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/resultado-busca.png" alt="Resultado busca" width="100%"/>
<p>Isso é reflexo de uma escolha de arquitetura do projeto: só são disponibilizados diários cuja publicação online nos garante criar a correspondência entre edição, seu município e data de publicação. Dizemos que é <b>incompatível</b> com a arquitetura do Querido Diário uma ação de raspagem em que não é possível obter esses dados. Não é o caso de ser inviável raspar o site em si, mas não nos dedicamos a criar um robô raspador já que não teremos informações (<i>metadados</i>) consideradas essenciais de se oferecer para pessoas usuárias da plataforma de busca (<i>imagine a imagem acima sem município ou data, a informação oficial ficaria sem contexto</i>).</p>
<h2>Os tipos de publicação</h2>
<p>Um ato oficial é o menor pedaço de um diário. Cada ato oficial tem uma categoria (portaria, decreto, etc) e o texto completo de um diário é o conjunto dessas categorias. Alguns municípios utilizam outra camada intermediária de agrupamento: por órgãos (secretarias, departamentos, etc). E, ainda, há aqueles que se aglutinam em associações e publicam um diário unificado contemplando todos os municípios associados.</p>
<p>Por não existir um padrão legal de publicação ou disponibilização eletrônica de diários, nos deparamos com prefeituras que liberam seus atos oficiais nos diferentes níveis de granularidade possíveis. Dentro do Querido Diário, nós adotamos nomes para cada situação: <b>completo</b>, <b>agregado</b> e <b>fragmentado</b>.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/panorama-diarios.png" alt="Panorama diários" width="100%"/>
<p><b>Diário completo</b> - o documento disponibilizado corresponde a um único município, exclusivamente. Um exemplo é o <a href="https://dodf.df.gov.br/" target="_blank">diário do Distrito Federal</a>, já integrado ao Querido Diário, cujo documento publicado contém apenas atos oficiais relacionados ao município.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/diario-brasilia.png" alt="Diário de Brasília(DF)" width="100%"/>
<p><b>Diário agregado</b> - o documento disponibilizado cobre diversos municípios, normalmente por serem uma Associação de Municípios ou o Diário do Estado. É o exemplo do <a href="https://www.diariomunicipal.com.br/ama/" target="_blank">Diário Oficial da Associação de Municípios de Alagoas</a> que publica os diários de mais de 100 municípios no mesmo documento. A página abaixo, de uma das edições, mostra atos oficiais de dois desses municípios, Cacimbinhas e Campo Alegre.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/diario-ama.png" alt="Diário da AMA" width="100%"/>
<p><b>Diário fragmentado</b> - quando não há propriamente um documento online, a prefeitura disponibiliza seus atos oficiais pulverizados. Um exemplo é <a href="https://braganca.pa.gov.br/decretos-2023/" target="_blank">Bragança (PA)</a> que ao invés de publicar um documento único, tem em seu site seções para 4 categorias (decretos, portarias, outros atos e leis) e, em cada uma delas, disponibiliza os atos separadamente.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/site-braganca-pa.png" alt="Diário de Bragança (PA)" width="100%"/>
<p>Nesse panorama de diferentes tipos de publicação, nossa referência são os <b>diários completos</b>, sendo os únicos compatíveis com a atual arquitetura do Querido Diário, enquanto os diários agregados e fragmentados, não.</p>
<p>No caso dos <b>agregados</b>, a incompatibilidade se dá pela impossibilidade de assegurar que determinado trecho diz respeito a qual das muitas cidades contidas no documento, necessitando de uma fase adicional de processamento para fatiar o conteúdo para cada município (segmentação por município).</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/segmentacoes.png" alt="Fluxo de segmentações" width="100%"/>
<p>Já para os <b>fragmentados</b> são necessários robôs raspadores mais complexos e um esquema de banco de dados mais granular que comporte novas relações entre dados de diferentes níveis.</p>
<p>Tendo em vista esses critérios, a possibilidade de uma cidade fazer parte do Querido Diário é resumida no fluxograma:</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/fluxograma-novas-cidades.png" alt="Fluxograma de novas cidades" width="100%"/>
<p>O projeto também não tem arquitetura para tratar arquivos em formatos diferentes de DOC, DOCX, TXT ou PDF de texto. Apesar de serem incompatibilidades relacionadas à etapa de processamento de dados, não de raspagem, elas dizem respeito a dificuldade em extrair o texto puro de dentro do arquivo coletado.</p>
<h2>Os tipos de sites</h2>
<p>Além dos diários, os sites publicadores também tem suas particularidades. Ao explorar mais, percebemos que alguns sites são muito parecidos, pois há prefeituras que contratam empresas prestadoras de serviços de desenvolvimento de sites ou de publicação de diários.</p>
<p>Uma vez que conhecemos o padrão (<i>sistema replicável</i>), a construção de raspadores para as cidades que se utilizam do serviço (<i>municípios replicados</i>) é muito simplificada, reflexo de uma escolha pela arquitetura orientada a objetos.</p>
<p>Utilizamos o <a href="https://scrapy.org/" target="_blank"><i>framework <b>scrapy</b></i></a> para construir a <a href="https://github.com/okfn-brasil/querido-diario/blob/main/data_collection/gazette/spiders/base/__init__.py" target="_blank">classe base de raspadores</a>, <i>BaseGazetteSpider</i>. Todos os raspadores de municípios são classes e herdam características de <i>BaseGazetteSpider</i>.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/diagrama-classes-1.png" alt="Diagrama de Classes 1" width="100%"/>
<p>Quando o município publica o próprio diário, sem utilizar de sistema replicável, seu raspador herda diretamente de <i>BaseGazetteSpider</i>. É o caso do <a href="https://github.com/okfn-brasil/querido-diario/blob/main/data_collection/gazette/spiders/df_brasilia.py" target="_blank">raspador para Brasília-DF</a>.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/raspador-dfbrasilia.png" alt="Raspador para Brasilia (DF)" width="100%"/>
<p>Já quando um município publica diários por meio de sistema replicável, adicionamos uma classe raspadora intermediária para o sistema, entre <i>BaseGazetteSpider</i> e o raspador do município.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/diagrama-classes-2.png" alt="Diagrama de Classes 2" width="100%"/>
<p>É o caso do <a href="https://github.com/okfn-brasil/querido-diario/blob/main/data_collection/gazette/spiders/ba_acajutiba.py" target="_blank">raspador de Acajutiba-BA</a>, que utiliza o sistema replicável <i>DoemGazetteSpider</i>.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/raspador-baacajutiba.png" alt="Raspador para Acajutiba (BA)" width="100%"/>
<p>Se ainda não o fez, experimente clicar nos <i>hiperlinks</i> para os raspadores de Brasília e Acajutiba referenciados acima, ambos estão em funcionamento hoje no Querido Diário. Note o tamanho de cada um: enquanto o de Brasília tem 100 linhas de código, o de Acajutiba apenas 10. Isto acontece por que, no caso de Acajutiba, a complexidade da raspagem está dentro do <a href="https://github.com/okfn-brasil/querido-diario/blob/main/data_collection/gazette/spiders/base/doem.py" target="_blank">raspador <i>DoemGazetteSpider</i></a> (e não deixe de reparar que este, por sua vez, que herda <i>BaseGazetteSpider</i>).</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/raspador-doem.png" alt="Raspador para DOEM" width="100%"/>
<p>Sistemas replicáveis são particularmente interessantes por potencializar a cobertura de municípios que podemos ter com menos esforço de desenvolvimento: uma vez que tenhamos a classe raspadora do sistema replicável, todas as cidades que o adotem demandam raspadores tão simples quanto o de Acajutiba. Conhecemos outras dezenas de cidades baianas que usam o DOEM e, em contraste, o raspador de Brasília serve apenas para Brasília.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/diagrama-classes-3.png" alt="Diagrama de Classes 3" width="100%"/>
<h2>Panorama</h2>
<p>Ainda que existam casos de incompatibilidade, a atual arquitetura de raspagem do Querido Diário atende relevante parte dos casos de disponibilização de diários oficiais municipais no Brasil. Além dos <a href="https://queridodiario.ok.org.br/cidades-disponiveis" target="_blank">67 municípios atualmente disponíveis</a>, temos perspectiva de atingir a marca de 250 cidades até o fim do ano de 2023. Você pode acompanhar o panorama no <a href="https://github.com/orgs/okfn-brasil/projects/12/views/1" target="_blank">Quadro de Expansão de Cidades no Querido Diário</a>.</p>
<img src="https://querido-diario-static.nyc3.cdn.digitaloceanspaces.com/blog/post0028/quadro-expansao.png" alt="Quadro de Expansão de Cidades" width="100%"/>
<h2>Desafios de aprimorar a arquitetura</h2>
<p>É importante destacar que só porque há contextos em que a adição de municípios é incompatível com a atual arquitetura, não implica que vai ser sempre assim. Aprimorar o projeto para tratar desses casos está em nossos objetivos. Uma vez que barreiras técnicas forem superadas, podemos voltar às atenções para os municípios que, hoje, são considerados incompatíveis.</p>
<p>Por exemplo, estudar como segmentar por municípios o diário agregado da Associação de Municípios de Alagoas (AMA) é <a href="https://danielfireman.github.io/ifal-qd/" target="_blank">objeto de Iniciação Científica</a> do Instituto Federal de Alagoas (AL), uma parceria no âmbito do programa <a href="https://ok.org.br/projetos/qd-universidades/" target="_blank">Querido Diário nas Universidades</a>. Ao incorporar na arquitetura a solução sendo desenvolvida, além da perspectiva de termos 102 municípios alagoanos integrados nos próximos meses, podemos avaliar se há possibilidade de usar a mesma - ou com poucas adaptações - ferramenta para outros diários agregados similares.</p>
<h2>Como contribuir</h2>
<p>Sendo um projeto colaborativo de <i>software</i> livre, todas as pessoas que tenham familiaridade com a área de tecnologia podem contribuir em <a href="https://queridodiario.ok.org.br/tecnologia#documentacao" target="_blank">diversos repositórios</a> (frontend, backend, API, infraestrutura, etc) conforme tenham interesse.</p>
<p>Estamos trabalhando em organizar o <a href="https://github.com/orgs/okfn-brasil/projects/14" target="_blank"><i>roadmap</i> do Querido Diário</a>, também conhecido como “mapa de metas”, uma lista dos principais desafios percebidos e de grande impacto para o projeto. Contribuições que nos ajudem a superar esses desafios-chave são especialmente relevantes.</p>
<p>Em particular no <a href="https://github.com/okfn-brasil/querido-diario" target="_blank">repositório de raspadores</a>, contribuições importantes são aquelas que adicionam raspadores para novas cidades e/ou sistemas replicáveis (confira <a href="https://docs.queridodiario.ok.org.br/pt-br/latest/escrevendo-um-novo-spider.html" target="_blank">as orientações</a> na documentação!) ou dêem manutenção em raspadores em produção.</p>
<p>Já em outros repositórios, mas que trazem reflexos para a cobertura de raspadores, há espaço para contribuições que nos ajude a tornar compatíveis as situações hoje incompatíveis, como: explorar a segmentação em Diários do Estado, aprimorar o esquema de banco de dados para receber diários fragmentados ou aprimorar o Reconhecimento Óptico de Caracteres (ROC, ou OCR em inglês) para diários escaneados.</p>
<p>Em todo caso, mantemos canais no <a href="https://go.ok.org.br/discord" target="_blank">Discord</a> para conversas sobre o projeto e seus diferentes aspectos. Além de trocas por mensagens, também fazemos uma reunião mensal com as pessoas mantenedoras aberta para a comunidade, sempre na última quinta-feira. Todas as pessoas são bem-vindas!</p>